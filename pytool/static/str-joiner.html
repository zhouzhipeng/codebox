<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>字符串拼接器</title>


    <link rel=stylesheet href="/static/codemirror/doc/docs.css">

    <link rel="stylesheet" href="/static/codemirror/lib/codemirror.css" />
    <script src="/static/codemirror/lib/codemirror.js"></script>
    <script src="/static/codemirror/addon/edit/matchbrackets.js"></script>
    <script src="/static/codemirror/mode/python/python.js"></script>
    <style>
        .tool{
            cursor: pointer;
            display: none;
            background-color: white;
            color: blue;
            position: absolute;
            left: 0px;
            top: 0px;
        }

        .CodeMirror {
            border-top: 0px solid black;
            border-bottom: 0px solid black;
            font-family: Arial, monospace;
            font-size: 16px;
            height: auto;
        }
    </style>
</head>
<body>
<h2>字符串拼接器</h2>
<a href="javascript:;"  onclick="showExample1()">示例1</a>
<a href="javascript:;"  onclick="showExample2()">示例2</a>


<div class="wenku" id="wenku">
    <textarea class="art" id="art" style="width:90%; height:300px" placeholder="输入字符串模板"></textarea>
    <p>
    <input type="button" style="    margin-top: 15px; margin-left: 30px;" onclick="formatText()" value="拼接">
    </p>
    <textarea class="art" id="resultArea" style="width:90%; height:150px; margin-left: 30px;" placeholder="点击拼接按钮，展示结果"></textarea>


</div>

<script type="text/javascript">
    function  showExample1(){
        let ss=`
#python inline code
% import time

% name = 'zhouzhipeng'


hello, my name is  {{name}}, time is {{int(time.time()*1000)}}


<%
#python code block
a=1
b=2
c=a+b

%>

a+b = {{c}}



Todo List

% todos = [{"name": "task1", "isDone": True},{"name": "task2", "isDone": False}]

<ul>

% for todo in todos:

% if todo['isDone']:
<li> {{todo['name']}} Finished </li>
% else:
<li> {{todo['name']}} </li>
%end

%end
</ul>
        `.trim();

        // initCode();
        mirror.getDoc().setValue(ss);
    }
    function  showExample2(){
        let ss=`
% from lib import db


% count = db.write("create table user(name text, age integer)")
{{count}}


% count = db.write("insert into user(name,age) values('zzz',18)")
{{count}}

% dataList = db.read("select * from user")
{{dataList}}

        `.trim();

        mirror.getDoc().setValue(ss);
    }
    async function  formatText(){

        let data = new FormData();
        data.append( "s", mirror.getDoc().getValue());

        let result = await (await fetch("/py/str-joiner/format-text",
            {
                method: "POST",
                body: data
            })).text()
        // resultArea.value= result.trim()
        resultMirror.getDoc().setValue(result.trim());
    }


    let mirror=CodeMirror.fromTextArea(document.getElementById("art"), {
        mode: {name: "python",
            version: 3,
            singleLineStringErrors: false},
        lineNumbers: true,
        indentUnit: 4,
        matchBrackets: true,
        viewportMargin: Infinity
    });


    let resultMirror = CodeMirror.fromTextArea(document.getElementById('resultArea'), {
        mode: "text",
        indentWithTabs: true,
        smartIndent: true,
        lineNumbers: true,
        matchBrackets : true,
        autofocus: true,
        viewportMargin: Infinity
        //extraKeys: {"Ctrl-Space": "autocomplete"},
        // hintOptions: {tables: {
        // 		users: ["name", "score", "birthDate"],
        // 		countries: ["name", "population", "size"]
        // 	}}
    });





</script>
</body>
</html>
