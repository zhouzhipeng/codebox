<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>sql执行器</title>
	<style>
		.tool{
			cursor: pointer;
			display: none;
			background-color: #f0c878;
			color: #27bb37;
			position: absolute;
			left: 0px;
			top: 0px;
		}
	</style>

</head>
<body>

	<textarea id="sqlInput" style="width: 100%; height: 300px;    font-size: 18px;"></textarea>

	<input type="button" onclick="runSql(this)" value="Run Selected"/>

	<hr/>
	<pre id="resultBlock"></pre>

	<script>
		let KEY_EXEC_PATH= "sql_runner.sql"

		if(localStorage.getItem(KEY_EXEC_PATH)){
			sqlInput.value=localStorage.getItem(KEY_EXEC_PATH)
		}


		async function runSql(btn){
			let txt = window.getSelection ? window.getSelection().toString() : document.selection.creatRange().text;

			if(!txt)return;

			btn.setAttribute("disabled","disabled")
			btn.value="Running..."


			localStorage.setItem(KEY_EXEC_PATH,txt)

			let data = new FormData();
			data.append( "sql", txt);

			let result = await (await fetch("/api/run-sql",
					{
						method: "POST",
						body: data
					})).text()
			resultBlock.innerText= result.trim()

			sqlInput.focus()

			btn.removeAttribute("disabled")
			btn.value="Run Selected"
		}
	</script>
</body>
</html>
