<html>
<head>
    <title>GoGo!</title>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

    </style>
</head>
<body>
<select onchange="switchIFrame(this.value)">
    <option value="/static/dd-upload.html">文件上传</option>

    {{if .IsLocal}}
    <option value="/views/media_open">开放多媒体</option>
    <option value="/static/clipboard.html">剪贴板</option>
    {{else}}
    <option value="/py/static/str-joiner.html">字符串拼接器</option>
    <option value="/sqlite-web/">sqlite-web</option>
    {{end}}
    <option value="/static/notes.html">sticky notes</option>
</select>
{{if .IsLocal}}
<a id="openInBrowserLink" href="/" target="_blank">Open In browser</a>
{{end}}
<!--<iframe id="mainContent" style="border: 0" src="dd-upload.html" title="iframe example 1" width="100%" height="100%">-->
<!--    <p>Your browser does not support iframes.</p>-->
<!--</iframe>-->

<span id="timeSpan"></span>
<a  href="/files/" target="_blank">Files</a>

<a  href="/files/message.txt" target="_blank">Logs</a>


<script type="text/javascript">
    (async ()=>{
        document.querySelector("#timeSpan").innerHTML=await (await fetch("/static/time.txt")).text();
    })();



    function switchIFrame(url) {
		let iframe = document.createElement('iframe');
		iframe.id="mainContent";
		iframe.src = url;
		iframe.style.border=0;
		iframe.width="100%";
		iframe.height="100%";
		let frame= document.querySelector("#mainContent");
		if(frame){
			frame.remove()
		}
		document.body.appendChild(iframe);
    }

    switchIFrame("/static/dd-upload.html");

    //window.location.href="http://127.0.0.1:59989/www"
    if (location.href.indexOf("islocal=1") !== -1) {
        window.addEventListener('beforeunload', async function (e) {
            e.preventDefault();
            // e.returnValue = '';
            console.log("browser close...");
            await fetch("/api/window-close")
        });

		window.addEventListener('beforeunload', async function (e) {
			e.preventDefault();
			// e.returnValue = '';
			console.log("browser close...");
			await fetch("/api/window-close")
		});

    }


    //禁用页面前进后退
    // history.pushState(null, null, document.URL);
    // window.addEventListener('popstate', function () {
    //     history.pushState(null, null, document.URL);
    // });

    {{if .IsLocal}}
    async function getLocalIP(){
        //获取ip
        let ip = await (await fetch("/api/get-local-ip")).text()
        document.querySelector("#openInBrowserLink").setAttribute("href","http://"+ip+":9999/")

    }

    getLocalIP();
    {{end}}
</script>
</body>
</html>